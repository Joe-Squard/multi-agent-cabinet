#!/bin/bash
# Multi-Agent Cabinet System v0.4.0 - Easy Command

CABINET_DIR="$(cd "$(dirname "$0")" && pwd)"

case "${1:-status}" in
    start)
        cd "$CABINET_DIR" && ./cabinet_start.sh
        ;;
    stop)
        cd "$CABINET_DIR" && ./cabinet_stop.sh
        ;;
    status)
        echo "ğŸ›ï¸  Cabinet System Status (v0.4.0)"
        echo ""
        echo "å¸¸é§ã‚»ãƒƒã‚·ãƒ§ãƒ³:"
        tmux list-sessions 2>/dev/null | grep -E "^(pm|chief|watcher)" || echo "  ã‚·ã‚¹ãƒ†ãƒ ã¯èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
        echo ""
        echo "å¤§è‡£ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ï¼‰:"
        tmux list-sessions 2>/dev/null | grep "^m_" || echo "  ç¨¼åƒä¸­ã®å¤§è‡£ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—"
        echo ""
        if [ -f "$CABINET_DIR/scripts/instance_count.sh" ]; then
            INSTANCES=$("$CABINET_DIR/scripts/instance_count.sh")
            echo "ğŸ“Š ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: ${INSTANCES} / 20"
        fi
        echo ""
        [ -f "$CABINET_DIR/dashboard.md" ] && cat "$CABINET_DIR/dashboard.md" || echo "dashboard.md ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        ;;
    pm|é¦–ç›¸)
        echo "ğŸ›ï¸  é¦–ç›¸ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶šã—ã¾ã™..."
        echo "ãƒ‡ã‚¿ãƒƒãƒ: Ctrl+b â†’ d"
        echo ""
        tmux attach-session -t pm
        ;;
    chief|å®˜æˆ¿|å®˜æˆ¿é•·å®˜)
        echo "ğŸ“‹ å†…é–£å®˜æˆ¿é•·å®˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶šã—ã¾ã™..."
        echo "ãƒ‡ã‚¿ãƒƒãƒ: Ctrl+b â†’ d"
        echo ""
        tmux attach-session -t chief
        ;;
    ministers|å¤§è‡£)
        echo "ğŸ‘¥ ç¨¼åƒä¸­ã®å¤§è‡£ã‚»ãƒƒã‚·ãƒ§ãƒ³:"
        tmux list-sessions 2>/dev/null | grep "^m_" || echo "  ç¨¼åƒä¸­ã®å¤§è‡£ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—"
        echo ""
        echo "æ¥ç¶š: tmux attach-session -t m_<type>"
        echo "  m_product (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ), m_research (ãƒªã‚µãƒ¼ãƒ)"
        echo "  m_arch (è¨­è¨ˆ), m_fe (FE), m_be (BE), m_mob (ãƒ¢ãƒã‚¤ãƒ«)"
        echo "  m_infra (ã‚¤ãƒ³ãƒ•ãƒ©), m_ai (AI), m_qa (QA)"
        echo "  m_design (ãƒ‡ã‚¶ã‚¤ãƒ³), m_uat (UAT)"
        echo ""
        echo "æ‰‹å‹•èµ·å‹•: ./scripts/minister_activate.sh <type>"
        echo "æ‰‹å‹•åœæ­¢: ./scripts/minister_deactivate.sh <type>"
        ;;
    activate)
        if [ -z "$2" ]; then
            echo "ä½¿ã„æ–¹: cabinet activate <type>"
            echo "  type: product, research, arch, fe, be, mob, infra, ai, qa, design, uat"
            exit 1
        fi
        cd "$CABINET_DIR" && ./scripts/minister_activate.sh "$2"
        ;;
    deactivate)
        if [ -z "$2" ]; then
            echo "ä½¿ã„æ–¹: cabinet deactivate <type>"
            echo "  type: product, research, arch, fe, be, mob, infra, ai, qa, design, uat"
            exit 1
        fi
        cd "$CABINET_DIR" && ./scripts/minister_deactivate.sh "$2"
        ;;
    help|--help|-h)
        echo "ğŸ›ï¸  Multi-Agent Cabinet System v0.4.0"
        echo ""
        echo "ä½¿ã„æ–¹:"
        echo "  cabinet              - çŠ¶æ…‹ç¢ºèªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰"
        echo "  cabinet start        - ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼ˆPM + Chief + Watcherï¼‰"
        echo "  cabinet stop         - ã‚·ã‚¹ãƒ†ãƒ åœæ­¢ï¼ˆå…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰"
        echo "  cabinet status       - çŠ¶æ…‹ç¢ºèª"
        echo "  cabinet pm           - é¦–ç›¸ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶š"
        echo "  cabinet chief        - å†…é–£å®˜æˆ¿é•·å®˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶š"
        echo "  cabinet ministers     - å¤§è‡£ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§"
        echo "  cabinet activate <t> - å¤§è‡£ãƒãƒ¼ãƒ èµ·å‹• (product/research/arch/fe/be/mob/infra/ai/qa/design/uat)"
        echo "  cabinet deactivate <t> - å¤§è‡£ãƒãƒ¼ãƒ åœæ­¢"
        echo ""
        ;;
    *)
        echo "âŒ ä¸æ˜ãªã‚³ãƒãƒ³ãƒ‰: $1"
        echo ""
        echo "ä½¿ã„æ–¹: cabinet [start|stop|status|pm|chief|ministers|activate|deactivate]"
        echo "ãƒ˜ãƒ«ãƒ—: cabinet help"
        ;;
esac
